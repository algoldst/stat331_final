"0","# First, we need each race's total population for 2015-2020."
"0","census <- read.csv(here::here(""acs2017_census_tract_data.csv""))"
"0",""
"0","census <- census %>%"
"0","  # Convert percentages to raw numbers"
"0","  mutate(across(.cols = c(""Hispanic"", ""White"", ""Black"", ""Native"", ""Asian"", ""Pacific""), "
"0","                .fns = ~.x/100.0*TotalPop)) %>%"
"0","  # Sum them up"
"0","  select(c(""Hispanic"", ""White"", ""Black"", ""Native"", ""Asian"", ""Pacific"")) %>%"
"0","  colSums(na.rm = TRUE) %>%"
"0","  round()"
"0",""
"0","# Save total as US Population total"
"0","us_population <- 326971407 - (2314238/2) # 2018 population - 1/2 growth in 2017 --> mid-2017 pop."
"0",""
"0","# Correct the names to be consistent with our dataset"
"0","census <- census %>%"
"0","  cbind(names(census)) %>%"
"0","  as.data.frame %>%"
"0","  mutate(V2 = ifelse(V2 == ""Native"", ""Native American"", V2),"
"0","         V2 = ifelse(V2 == ""Pacific"", ""Other"", V2)) %>%"
"0","  rename(race = V2)"
"0",""
"0","# Make ""Other"" actually the ""Other"" population and not just Pacific Islanders"
"0","census$. <- as.integer(census$.)"
"0","census$.[6] <- us_population - (sum(census$.) - census$.[6])"
"0",""
"0","# Flip the order"
"0","census <- census[c(2,1)]"
"0","# --------------"
"0",""
"0","## Normalize by_race"
"0","# Combine into copy of ""by_race"""
"0","by_race2 <- right_join(census, by_race, by=""race"")"
"0","by_race2 <- by_race2 %>%"
"0","  rename(Population = ""."") %>%"
"0","  mutate(Population = as.integer(Population))"
"0",""
"0","# Get adjusted percentages by racial populations"
"0","by_race2 <- by_race2 %>%"
"0","  mutate(`Percent Of US` = Population / us_population * 100,"
"0","         `Ratio Shot vs Population` = `Proportion of Total` / (`Percent Of US`))"
"0",""
"0","# Clean up variable names"
"0","by_race2 <- by_race2 %>%"
"0","  rename(Race = race, `Total Shot` = n)"
"0","  "
"0","## Normalize `shoootings`"
"0","# Join with census data"
"0","shootings_norm <- shootings2 %>%"
"0","  mutate(`Total Shot` = 1) %>%"
"0","  aggregate(`Total Shot` ~ year(date) + race, data=., sum) %>%"
"0","  left_join(census, by=""race"") %>%"
"0","  rename(Population = ""."", Year = `year(date)`) %>%"
"0","  mutate(Population = as.integer(Population)) %>%"
"0","  mutate(`Population Percent` = Population / us_population * 100)"
"0",""
"0","# Get totals shot in the year"
"0","shootings_norm <- shootings_norm %>%"
"0","  group_by(Year) %>% "
"0","  summarize(sum(`Total Shot`)) %>%"
"0","  rename(`Total Shot in Year` = ""sum(`Total Shot`)"") %>%"
"0","  right_join(shootings_norm, by=""Year"") %>%"
"0","  mutate(`Proportion of Shootings In Year` = `Total Shot` / `Total Shot in Year` * 100)"
"2","`summarise()` ungrouping output (override with `.groups` argument)
"
"0","# Normalize proportions by population percentage"
"0","shootings_norm <- shootings_norm %>%"
"0","  mutate(`Ratio Shot vs Population` = `Proportion of Shootings In Year` / `Population Percent`)"
"0",""
"0","# Output -----------"
"0","# Display racial breakdown"
"0","by_race2 %>%"
"0","  select(-c(""Population"", ""Proportion of Total"")) %>%"
"0","  arrange(desc(`Ratio Shot vs Population`))"
